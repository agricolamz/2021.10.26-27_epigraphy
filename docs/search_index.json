[["работа-с-картами-пакет-leaflet.html", "4 Работа с картами пакет leaflet 4.1 Визуализация с leaflet 4.2 Раскраска на основании переменной 4.3 Динамическое отображение переменной", " 4 Работа с картами пакет leaflet 4.1 Визуализация с leaflet Для начала включим библиотеку: library(&quot;tidyverse&quot;) library(&quot;leaflet&quot;) и скачаем датасет: df &lt;- read_csv(&quot;https://tinyurl.com/yzfgony9&quot;) Мы можем нарисовать точки, полученные из кладбища в Стародубе: df %&gt;% filter(place == &quot;Стародуб&quot;) %&gt;% leaflet() %&gt;% addTiles() %&gt;% addCircles(lng = ~longitude, lat = ~latitude, stroke = NA, radius = 1, fillOpacity = 1, label = ~tombstone_code) в Бешенковичах: df %&gt;% filter(place == &quot;Бешенковичи&quot;) %&gt;% leaflet() %&gt;% addTiles() %&gt;% addCircles(lng = ~longitude, lat = ~latitude, stroke = NA, radius = 1, fillOpacity = 1, label = ~tombstone_code) Используя предыдущий код постройте карту кладбища в Рашкове. 4.2 Раскраска на основании переменной Мы можем раскрасить наши точки на основании гендерной пренадлежности усопшего: pal_gender &lt;- colorFactor(&quot;Set1&quot;, domain = df$gender) df %&gt;% filter(place == &quot;Стародуб&quot;) %&gt;% leaflet() %&gt;% addTiles() %&gt;% addCircles(lng = ~longitude, lat = ~latitude, stroke = NA, radius = 1, fillOpacity = 1, label = ~tombstone_code, color = ~pal_gender(gender)) %&gt;% addLegend(pal = pal_gender, values = ~gender, title = &quot;&quot;) Зеленых точек n достаточно много, можно попробовать их убрать: df %&gt;% filter(place == &quot;Стародуб&quot;, gender != &quot;n&quot;) %&gt;% leaflet() %&gt;% addTiles() %&gt;% addCircles(lng = ~longitude, lat = ~latitude, stroke = NA, radius = 1, fillOpacity = 1, label = ~tombstone_code, color = ~pal_gender(gender)) %&gt;% addLegend(pal = pal_gender, values = ~gender, title = &quot;&quot;) Попробуем нарисовать кладбище в Бешенковичах и посмотрим, где расположены надгробия с тегами роженица: df %&gt;% mutate(labour = str_detect(tags, &quot;роды&quot;), labour = ifelse(is.na(labour), FALSE, labour)) -&gt; df pal_labour &lt;- colorFactor(&quot;Set1&quot;, domain = c(TRUE, FALSE), ordered = TRUE) df %&gt;% filter(place == &quot;Бешенковичи&quot;) %&gt;% leaflet() %&gt;% addTiles() %&gt;% addCircles(lng = ~longitude, lat = ~latitude, stroke = NA, radius = 1, fillOpacity = 1, label = ~tombstone_code, color = ~pal_labour(labour)) %&gt;% addLegend(pal = pal_labour, values = ~labour, title = &quot;Распределение рожениц&quot;) Убитые, оставляем? df %&gt;% mutate(kadosh = str_detect(tags, &quot;(кадош)|(погром)|(убит)&quot;), kadosh = ifelse(is.na(kadosh), FALSE, kadosh)) -&gt; df pal_kadosh &lt;- colorFactor(&quot;Set1&quot;, domain = c(TRUE, FALSE), ordered = TRUE) df %&gt;% filter(place == &quot;Рашков&quot;) %&gt;% leaflet() %&gt;% addTiles() %&gt;% addCircles(lng = ~longitude, lat = ~latitude, stroke = NA, radius = 1, fillOpacity = 1, label = ~tombstone_code, color = ~pal_kadosh(kadosh)) %&gt;% addLegend(pal = pal_kadosh, values = ~kadosh, title = &quot;Распределение убитых&quot;) Цветом можно задавать не только категориальны данные, но и числовые: pal_year &lt;- colorNumeric(&quot;BrBG&quot;, domain = df$year) df %&gt;% filter(place == &quot;Стародуб&quot;, !is.na(year), !is.na(latitude)) %&gt;% leaflet() %&gt;% addTiles() %&gt;% addCircles(lng = ~longitude, lat = ~latitude, stroke = NA, radius = 1, fillOpacity = 1, label = ~tombstone_code, color = ~pal_year(year)) %&gt;% addLegend(pal = pal_year, values = ~year, title = &quot;Распределение по годам&quot;) 4.3 Динамическое отображение переменной Попробуем нарисовать кладбище в Рашков и посмотрим в динамике, как оно заполнялось: df %&gt;% filter(place == &quot;Рашков&quot;, !is.na(year)) %&gt;% group_by(tombstone_code) %&gt;% mutate(id = 1:n()) %&gt;% filter(id == 1) %&gt;% ungroup() %&gt;% mutate(value = 1) %&gt;% arrange(-year) %&gt;% pivot_wider(names_from = year, values_from = value, values_fill = 0) %&gt;% pivot_longer(values_to = &quot;value&quot;, names_to = &quot;year&quot;, `1710`:`1980`) %&gt;% group_by(tombstone_code, id) %&gt;% mutate(value = cumsum(value)) -&gt; rsh_sum library(leaflet.minicharts) leaflet() %&gt;% addTiles() %&gt;% addLegend(pal = pal_gender, values = rsh_sum$gender, title = &quot;&quot;) %&gt;% addMinicharts(lng = rsh_sum$longitude, lat = rsh_sum$latitude, chartdata = rsh_sum$value, time = as.double(rsh_sum$year), fillColor = pal_gender(rsh_sum$gender), width = 7) "],["404.html", "Page not found", " Page not found The page you requested cannot be found (perhaps it was moved or renamed). You may want to try searching to find the page's new location, or use the table of contents to find the page you are looking for. "]]
